<div class="interactive-widget" id="bit-depth-widget">
    <canvas id="bit-depth-canvas" width="800" height="200"></canvas>
    <div class="widget-controls">
        <label>Bit Depth: <select id="bit-depth-select">
                <option value="8">8 bpc</option>
                <option value="10">10 bpc</option>
                <option value="12">12 bpc</option>
            </select></label>
        <label>Zoom Dark End: <input type="range" id="bit-depth-zoom" min="1" max="50" value="1" step="0.1"></label>
    </div>
    <div class="widget-explainer">
        Select a lower bit depth (e.g., <strong>8 bpc</strong>) and increase <strong>Zoom</strong> to see quantization
        banding artifacts in the dark gradients.
    </div>
</div>
<script>
    (function () {
        const canvas = document.getElementById('bit-depth-canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;

        function draw() {
            const depth = parseInt(document.getElementById('bit-depth-select').value);
            const zoom = parseFloat(document.getElementById('bit-depth-zoom').value);

            const levels = Math.pow(2, depth) - 1;
            const imageData = ctx.createImageData(width, height);
            const data = imageData.data;

            // We draw a linear gradient from black to white.
            // Zoom focuses on the dark end (0..1/zoom)

            for (let x = 0; x < width; x++) {
                // Normalized position 0..1
                let t = x / width;

                // Apply zoom (focus on darks)
                t = t / zoom;

                // Linear value 0..1
                let val = t;

                // Quantize
                val = Math.floor(val * levels) / levels;

                // Apply gamma correction (approx 2.2) for display
                // We simulate Linear -> sRGB display
                // If we didn't apply gamma, thebanding would be less visible in darks on a standard monitor
                // But here we want to show the banding in the values themselves.
                // To make it visible on screen, we convert linear value to sRGB byte

                let displayVal = Math.pow(val, 1 / 2.2);

                // Convert to 8-bit component for canvas
                let pixelVal = Math.floor(displayVal * 255);

                // Fill column
                for (let y = 0; y < height; y++) {
                    const idx = (y * width + x) * 4;
                    data[idx] = pixelVal;
                    data[idx + 1] = pixelVal;
                    data[idx + 2] = pixelVal;
                    data[idx + 3] = 255;
                }
            }

            ctx.putImageData(imageData, 0, 0);

            // Draw text info
            ctx.fillStyle = zoom > 10 ? '#fff' : '#000';
            ctx.font = '14px sans-serif';
            ctx.fillText(`Displaying 0 - ${(100 / zoom).toFixed(1)}% Luminance`, 10, 30);
        }

        document.getElementById('bit-depth-select').addEventListener('change', draw);
        document.getElementById('bit-depth-zoom').addEventListener('input', draw);

        draw();
    })();
</script>